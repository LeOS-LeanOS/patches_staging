From 1498535116f1bab1bacb0c5432dcdfa561be5611 Mon Sep 17 00:00:00 2001
From: "Christopher A. Williamson" <contact@chrisaw.io>
Date: Tue, 27 May 2025 09:21:08 +0100
Subject: [PATCH 2/6] Allow a prop to override DOZE_SUSPEND to DOZE for AoD if
 device doesnt support DOZE_SUSPEND

---
 .../com/android/server/display/DisplayPowerController.java   | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/services/core/java/com/android/server/display/DisplayPowerController.java b/services/core/java/com/android/server/display/DisplayPowerController.java
index 7721bef26..539a2a583 100644
--- a/services/core/java/com/android/server/display/DisplayPowerController.java
+++ b/services/core/java/com/android/server/display/DisplayPowerController.java
@@ -1437,6 +1437,11 @@ final class DisplayPowerController implements AutomaticBrightnessController.Call
                 mDisplayStateController
                         .updateDisplayState(mPowerRequest, mIsEnabled, mIsInTransition);
         int state = stateAndReason.first;
+        boolean disableDisplayDozeSuspend = SystemProperties.get("persist.sys.phh.disable_display_doze_suspend", "0").equals("1");
+
+        if (disableDisplayDozeSuspend && state == Display.STATE_DOZE_SUSPEND) {
+            state = Display.STATE_DOZE;
+        }
 
         // Initialize things the first time the power state is changed.
         if (mustInitialize) {
--
2.47.2
